<!doctype html>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js"></script>
<link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/default.min.css">
<script>hljs.highlightAll();</script>
<script src="inductor.js"></script>

<style>
.rpic  {
 float: right;    
 margin: 0 0 0 15px;
}
.lpic  {
 float: left;    
 margin: 0 0 0 15px;
</style>

<body>
<div classs=container>

<section class=section>

<div class=box>
<div class=title>Repurposing a Brushless DC Motor from an Air Conditioning Unit </div>
<p>Ravi Saripalli</p>
</div>

  <h2 class=subtitle>The Beginings</h2>
  <div class=block>
    This project started with me stripping apart a failed BLDC
    <a href="https://www.integrasources.com/blog/bldc-motor-controller-design-principles/">
      (Brushless DC motor)</a> 
  from 
  my home air conditioner unit with a desire to repurpose it for other use. The 
  integral printed circuit board (PCB) inside this comapct motor was fried due to failed rectifier
  bridge output capacitort(450V, 120uF) on the external PCB. 
  This bridge circuit on the external PCB  provides 350VDC supply to the motor.
  Also, it provides 15V DC and other control signals to internal PCB to drive the motor.
  </div>
  <div class=block>
  I have to track back to earlier events  that led me to this point. It all
  started with our indoor AC unit (Split System)  suddenly stopping
  with a faint spluttering sound in the middle of a winter morning. This happened
  just a day after  
  I cleaned the air filter grill on the unit. I also placed a fragant cotton swab
  for a warm and sweet ambiance.  
  Not surprisingly, family attributes the failure to my cleaning act!!!
  So begins my journey into split AC units,
 BLDC motors and their inner workings. Interested ... then read on.
  </div>
  <h2 class=subtitle>First Dive</h2>
  <div class=block>
      When I tried to start the unit with the remote  the unit did 
      not respond and the usual green remote sensor light did not blink..
     The AC unit on the wall controls the blower fan and two other small motors that move the
     grill vanes to direct the air flow. The unit appeared to have lost power.
  </div>

  <div class=block>
     Examining the control board, I noted that the 1.5Amp slow acting ceramaic
     fuse in the control board was blown. This 
     fuse was soldered to the board.  Now,
     I know why it was not easily repalceable fuse. When it fails, it means there is
     something seriously wrong in either the PCB board or in the motors that it controls.
     Trust me, one can't just replace the fuse and hope for the best. I blew 200$AU in a flash,
     when I replaced a failed control board and fuse trying fix our 
     washing machine assuming the water leak was the cause and not investigating any further.
     Post event I located a short at motor supply terminals(with a Megger) at 240V.
  </div>

  <div class=block>
  <h2 class=subtitle>The Culprit</h2>
  <div class=block>
     Further examination of the PCB showed the large output 
     filter capacitor
     on the bridge rectifier had a slight bulge.
     I tried to measure its capacitance with a multi-meter while in circuit, but it
     did not give any meaningful results.
  </div>
  <div class=block>
    <figure class="image">
      <img src="crapcap.png" >
    </figure>
  </div>

  <div class=block>
     Knowing that its failure has implications to BLDC motor power supply, repalced it
     with a new one. With the new capacitor and fuse the 
     PCB was alive and I
     was able to operate the small louvers that deflect the air (driven by  tiny motors) with
     the remote control. But the main blower won't run but displayed an error code
     suggesting a possible fault in the blower motor or the PCB. I disconnected blower motor and 
     checked the supply voltage pins on the external PCB (350V DC voltage for BLDC motor, and 15V for
     its inernal PCB) they all looked good. So it appears that
     the problem is likey to be in the motor. Perhaps, the fault in the filter capacitor
     (failed open), would have introduced too much ripple in  BLDC supply voltage that could
     damage the motor.

  </div>
  <div class=block>
  <h2 class=subtitle>A Good Ending </h2>
     With winter in full swing the pressure was on
     to get the unit going. So I ordered a replacement motor, which fortunately arrived
     after a week despite the COVID mayhem. But now the issue is to figure out the
     way to remove the old motor from the unit to replace it.
     Fortunately 
     <a href="https://www.daikinac.com/content/assets/DOC/ServiceManuals/SiUS091133-FTXS-LFDXS-L-Inverter-Pair-Service-Manual.pdf">
     Daikin service manual</a>
     is up for grabs on the internet. The task of
     removing the fan motor appeared very daunting with the requirement to disconnect the
     Air Conditioner evaporator  coils from the unit. A big job indeed.
     But thanks to excellent tips from a  <a href="https://www.youtube.com/watch?v=IQrudzq0tmM&t=28s">
       nice video</a>
     by a Daikin service guy, I could get to the blower fan without 
     dismantling the heat exchanger.  Replacing the motor truned out to be a breeze.
     
     After all this effort, with  great trepidation I turned on the unit in heating mode with
     high fan speed setting and it worked  purring like a cat.
     The air warmed up with nods of approval from my missus.
  </div>

</div>

  <h2 class=subtitle>Post Mortem </h2>
  <div class=block>
  This was the state of PCB inside the motor once I removed the top cover of the motor
  assembly. Pretty bad ha :((
  </div>
    <figure class="image">
      <img src="bldPCB.png">
    </figure>
</div>

<div class=box>
<div class=block>
  The stator is an enclosed unit with terminals of windings exposed. The rotor 
  is made of strong permanent magnet (possibly RareEarth Neodemium). 
  The rotor chases the magnetic field that is rotated 
  electronically switching the coils of the stator poles at right times 
  based on
  the feedback of HAL (magnetic field sensors) senosors 
  embedded in the stator body. Alternately, one could use the back emf signal
  as a sensing tool. I am still not sure as to which mechanism this motor uses.
</div>
  
<div class=block>
  Checking the four terminals on the stator block, it appears that there are three
  coils connected in star fashion. The three coil resistances are 40ohms each. This
  suggests that the stator windings are unlikely to be damaged and the motor failed due to PCB 
  components that could not tolerate large current spikes because of failed  ripple
  filter capacitor on the high voltage supply to the BLDC motor.
</div>

<div class=block>
  Once the PCB terminals are desoldered off the stator block face,
  the PCB could be pried out of the stator casing. 
  Then the rotor simply can be pulled out
  along with the rear bearing.
</div>
<p></p>
<figure class="image">
  <img src="bldRotor.png"> </img>
</figure>
</div>

<div class=box>
 <div class=block>
 The following picture shows the terminal connections to the BLDC motor. 
 The motor connector has five lines. It also shows how the internal
 PCB sits over the stator housing. The white blob on the IC 
 is dried out thermal conductivity paste to help
 disspate heat via 
 top cover metal plate of the motor.(removed here)
 </div>
    <figure class="image">
      <img src="bldcMotor.png" > </img>
    </figure>
    <table class="table is-bordered is-striped" float='right'>
       <tr><td>1</td><td>red</td><td>Motor Supply 450VDc </td></tr>
       <tr><td>2</td><td>blue</td><td>gnd </tr>
       <tr><td>3</td><td>brown</td><td>Motor Coils Control Signal  </tr>
       <tr><td>4</td><td>orange</td><td>HAL sensor output </tr>
       <tr><td>5</td><td>white</td><td> PCB Vcc 15V </td> </tr>
    </table>
</div>

<div class=box>
 <h2 class=subtitle>Resurrecting the Victim </h2>

 <div class=block>
Now that I had some win with the Air Conditioner, and had a whiff of what a BLDC motor is
I was wanting to explore if I can use most of the usable part of the motor without the
internal and external control boards. The idea was to use Raspberry PI like IOT (Internet Of Things)  devices,
to provide the necessary control signals and drive the motor with an external motor drive circuit
of my own making.
It means I have to think of  providing control signals while sensing rotor position
with either HAL sensors or use sensorless method (using back emf signals from the coils).
Playing with MOSFETs to provide switching would be fun for I have never done such things before.
 </div>

 <div class=block>
To start off I wanted to work at lower voltage (12-24VDC)level rather than at high DC voltage the motor
is designed for. I realise that I have to sacrifice the motor torque since the motor stator
windings are designed for high voltage and low currents (to achieve compactness). 

For starters I wanted to get a measure of inductance of the motor windings, so that I can judge
the switching frequencies I need to operate at without stressing stator windings.
 </div>

 <h3 class=subtitle>Inductance Measurement </h3>
<div class=block>
This has turned into another side alley I had to explore to achieve my goal. After viewing
several youtube videos, decided to exploit my oscilloscope square wave reference output
with an LC circuit consisting of known capcitance values. Since the reference output can not source
much current, I used an NPN transistor switch with its base driven by the 
the reference square wave signal. This enabled a square wave signal source at 1kHz that can
source  reasonable currents.
<div class=block>

<div class=block>
Measuring the ringing frequency of the
circuit on square wave edge transitions, the inductance can be estimated from simple theoretical
expression for resonant frequency.  I learnt, while this looks straight forward, there are many other
intricacies to consider if one is really interested in accurate inductance measurement. (eg. dependency
of series resistance on the frequency level the inductor is operating at).
</div>
</div>

<div class=block>
Once the resonant frequency at different capcitance values were obtained 
the inductance of the coil can be estimated from linear regression of 
Capacitance versus log(Frequency).(Feq = 1/ 2.Pi.sqrt(LC)). The inductor I used 
was something I cobbled up using a Ferrite core and some 28guage wire wound
over it. The ferrite core was from TV power chord noise suppresor. Although,
it is easy to get physical construct details such as number of turns, length and
cross sectional area of the inductor coil, the magnetic permeability is not all
that well defined for ferrite (it varies from 16 to 400 H/m)
Anyway, I had a stab at estimating it and taking the lower end ferrite permiability for the
coil. The estimated value was of the order of 14mH. 
</div>
<div class=block>
    <figure class="image">
      <img src="inductor.png"  > </img>
    </figure>
</div>

<div class=block>
The following figure shows the simulation of the
circuit that approximates my experimental setup. I have omited my transitor based
switching circuit for simplicity and clarity. The
<a href="https://www.falstad.com/circuit/">
  fully featured circuit simulator</a> is 
freely available and can be used interactively from your browser.
A real example that shows many good things are for free. And I was quite impressed
by what it can do.
</div>
 <div class=block>
    <table class="table is-bordered is-striped" float='right'>
      <tr><th>Test</th><th>Cap.(nF)</th><th>Freq.(kHz)</th><th>Freq.(kHz)</th></tr>
      <tr><th></th><th></th><th>Experiment </th><th>Simulation</th></tr>
      <tr><td>1</td><td>53.5</td><td>12.8</td><td>14.2</td></tr>
      <tr><td>2</td><td>75.4</td><td>10.4</td><td>11.9</td> </tr>
      <tr><td>3</td><td>104.3</td><td>9.4</td><td>10.1</tr>
      <tr><td>4</td><td>111</td><td>8.7</td><td>9.8 </tr>
      <tr><td>5</td><td>235</td><td>5.8</td><td>6.8</tr>
      <tr><td>6</td><td>346</td><td>4.8</td><td>5.5</tr>
    </table>
    <figure class="image">
      <img src="sim.png" > </img>
    </figure>
</div>
<div class=block>
  Fitting the above data on a log-linear plot, the experimental data gave a
  slope of -0.52 which is very close to theoretically expected value. (inverse Square root 
  reltion of capacitance with resonant frequency). The simulator gave exactly -0.5 as one would expect.
  Finally the estimated value of indutance from the above data is 2.35mH. (About 1/6th of
  my theoretical estimate based on inductor physical properties).
</div>
<div class=block>
  I am now satisified that I can get an order of magnitude estimate  of 
  the inductance of my motor coil with this LC circuit set up.
</div>
  <h2 class=subtitle>To be Continued ....</h2>
</div>
</div>
</section>
</body>
</html>
